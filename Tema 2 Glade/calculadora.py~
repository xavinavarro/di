#! /usr/bin/env python

import sys
try:
	import pygtk
	
except:
	pass
try:
	import gtk
	import gtk.glade
except:
	print('GTK no disponible')
	sys.exit(1)

class Calculadora:
	def init(self):
		self.gladefile = "Calculadora.glade"
		self.wTree = gtk.glade.XML(self.gladefile)
		dic = {
			"on_window_calculator_destroy" :self.quit,
			"on_close_clicked" : self.quit,
			"on_CE_clicked" : self.displayCE,
			"on_Clear_clicked" : self.displayClr,
			"on_Porcentaje_clicked" : self.displayMod,
			"on_Siete_clicked" : self.displaySeven,
			"on_Ocho_clicked" : self.displayEight,
			"on_Nueve_clicked"  : self.displayNine,
			"on_Division_clicked" : self.displayDiv,
			"on_Cuatro_clicked" : self.displayFour,
			"on_Cinco_clicked" : self.displayFive,
			"on_Seis_clicked" : self.displaySix,
			"on_Multiplicar_clicked" : self.displayMultiply,
			"on_Uno_clicked" : self.displayOne,
			"on_Dos_clicked" : self.displayTwo,
			"on_Tres_clicked" : self.displayThree,
			"on_Menos_clicked" : self.displayMinus,
			"on_Cero_clicked" : self.displayZero,
			"on_Coma_clicked" : self.displayDot,
			"on_Igual_clicked" : self.displayEqual,
			"on_Suma_clicked" : self.displayAdd,
			}
		self.wTree.signal_autoconnect(dic)
		self.window = self.wTree.get_widget("window_calculator")
		self.window.show()

	def displayOperand(self,operand):
		self.wTree.get_widget("displayText").insert_text(operand,position=20)

	def compute(self,operator):
		if operator == 'Clr':
			self.wTree.get_widget("displayText").set_text("")
		if operator == 'CE':
			self.wTree.get_widget("displayText").set_text("0")	
		if operator == "+":
			self.flag = 1
			self.firstOperand = self.wTree.get_widget("displayText").get_text()
			self.wTree.get_widget("displayText").set_text("")
		if operator == '-':
			self.flag = 2
			self.firstOperand = self.wTree.get_widget("displayText").get_text()
			self.wTree.get_widget("displayText").set_text("")
		if operator == '*':
			self.flag = 3
			self.firstOperand = self.wTree.get_widget("displayText").get_text()
			self.wTree.get_widget("displayText").set_text("")
		if operator == '/':
			self.flag = 4
			self.firstOperand = self.wTree.get_widget("displayText").get_text()
			self.wTree.get_widget("displayText").set_text("")
		if operator == '%':
			self.flag = 5
			self.firstOperand = self.wTree.get_widget("displayText").get_text()
			self.wTree.get_widget("displayText").set_text("")
		if operator == '=':
			self.secondOperand = self.wTree.get_widget("displayText").get_text()
			sum1 = float(self.firstOperand)
			sum2 = float(self.secondOperand)
			if self.flag == 1:
				result = sum1 + sum2
			if self.flag == 2:
				result = sum1 - sum2
			if self.flag == 3:
				result = sum1 * sum2
			if self.flag == 4:
				if sum2 == 0.0:
					try:
						result = sum1 / sum2
					except:						
						result = "Math operation error"
				else:
					result = sum1 / sum2
			if self.flag == 5:
				sum1 = int(sum1)
				sum2 = int(sum2)
				result = sum1 % sum2
			self.wTree.get_widget("displayText").set_text(str(result))
	
	def displayClr(self,widget):
		self.compute("Clr")

	def displayCE(self,widget):
		self.compute("CE")	

	def displaySeven(self,widget):
		self.displayOperand("7")

	def displayEight(self,widget):
		self.displayOperand("8")

	def displayNine(self,widget):
		self.displayOperand("9")
	
	def displayFour(self,widget):
		self.displayOperand("4")

	def displayFive(self,widget):
		self.displayOperand("5")

	def displaySix(self,widget):
		self.displayOperand("6")

	def displayOne(self,widget):
		self.displayOperand("1")

	def displayTwo(self,widget):
		self.displayOperand("2")

	def displayThree(self,widget):
		self.displayOperand("3")

	def displayZero(self,widget):
		self.displayOperand("0")

	def displayDot(self,widget):
		self.displayOperand(".")	

	def displayMod(self,widget):
		self.compute("%")	
	
	def displayDiv(self,widget):
		self.compute("/")	

	def displayMultiply(self,widget):
		self.compute("*")
	
	def displayMinus(self,widget):
		self.compute("-")
	
	def displayEqual(self,widget):
		self.compute("=")

	def displayAdd(self,widget):
		self.compute("+")

	def quit(self,widget):
		sys.exit(0)

if __name__ == "__main__":	
	cal = Calculadora()
	gtk.main()
	
	
